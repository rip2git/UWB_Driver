#ifndef CRC_H
#define CRC_H


#include <stdint.h>



/*! ----------------------------------------------------------------------------------------
 * @brief: Provides to take check sum of some data (CRC and CRC16)
 * -----------------------------------------------------------------------------------------
 * */
class CheckSum {
public:
	/*! ------------------------------------------------------------------------------------
	 * @brief:
	 * -------------------------------------------------------------------------------------
	 * */
	CheckSum()
	{
		CRC16_MakeTable();
		CRC8_MakeTable();
	}

	/*! ------------------------------------------------------------------------------------
	 * @brief:
	 * -------------------------------------------------------------------------------------
	 * */
	uint16_t GetCRC16(const uint8_t *buf, uint16_t len) const
	{
		uint16_t crc;
		crc = 0xFFFF;
		while (len--) {
			crc = this->crc16table[ ((crc >> 8) ^ *buf++) & 0xFF ] ^ (crc << 8);
		}
		crc ^= 0xFFFF;
		return crc;
	}

	/*! ------------------------------------------------------------------------------------
	 * @brief:
	 * -------------------------------------------------------------------------------------
	 * */
	uint8_t GetCRC8(const uint8_t *buf, uint8_t len) const
	{
		uint8_t crc;
		crc = 0xFF;
		while (len--) {
			crc = this->crc8table[ (crc ^ *buf++) & 0xFF ];
		}
		crc ^= 0xFF;
		return crc;
	}

private:
	/*! ------------------------------------------------------------------------------------
	 * @brief:
	 * -------------------------------------------------------------------------------------
	 * */
	uint8_t crc8table[256];

	/*! ------------------------------------------------------------------------------------
	 * @brief:
	 * -------------------------------------------------------------------------------------
	 * */
	uint16_t crc16table[256];

	/*! ------------------------------------------------------------------------------------
	 * @brief: Makes codes. Standard polynomial: 0x8005
	 * -------------------------------------------------------------------------------------
	 * */
	inline void CRC16_MakeTable()
	{
		uint16_t i;
		uint16_t r;
		uint8_t j;

		for (i = 0; i < 256; i++) {
			r = i << 8;
			for (j = 0; j < 8; j++) {
				if (r & (1 << 15))
					r = (r << 1) ^ 0x8005;
				else
					r = r << 1;
			}
			this->crc16table[i] = r;
		}
	}

	/*! ------------------------------------------------------------------------------------
	 * @brief: Makes codes. Standard polynomial: 0x31
	 * -------------------------------------------------------------------------------------
	 * */
	inline void CRC8_MakeTable()
	{
		uint16_t i;
		uint8_t r;
		uint8_t j;

		for (i = 0; i < 256; i++) {
			r = static_cast<uint8_t>(i);
			for (j = 0; j < 8; j++) {
				if ((r & 0x80))
					r = (r << 1) ^ 0x31;
				else
					r = r << 1;
			}
			this->crc8table[i] = r;
		}
	}
};


#endif
