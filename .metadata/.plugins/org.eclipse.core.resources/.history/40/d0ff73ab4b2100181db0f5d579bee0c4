#ifndef CRC_H
#define CRC_H


typedef unsigned char byte_t;
typedef unsigned short dbyte_t;



/* -----------------------------------------------------------------------------------------
 * Provides to take check sum of some data (CRC and CRC16)
 * -----------------------------------------------------------------------------------------
 * */
class CheckSum {
public:
	/* -------------------------------------------------------------------------------------
	 * -------------------------------------------------------------------------------------
	 * */
	CheckSum()
	{
		CRC16_MakeTable();
		CRC8_MakeTable();
	}

	/* -------------------------------------------------------------------------------------
	 * -------------------------------------------------------------------------------------
	 * */
	dbyte_t GetCRC16(const byte_t *buf, dbyte_t len) const
	{
		dbyte_t crc;
		crc = 0xFFFF;
		while (len--) {
			crc = this->crc16table[ ((crc >> 8) ^ *buf++) & 0xFF ] ^ (crc << 8);
		}
		crc ^= 0xFFFF;
		return crc;
	}

	/* -------------------------------------------------------------------------------------
	 * -------------------------------------------------------------------------------------
	 * */
	byte_t GetCRC8(const byte_t *buf, byte_t len) const
	{
		byte_t crc;
		crc = 0xFF;
		while (len--) {
			crc = this->crc8table[ (crc ^ *buf++) & 0xFF ];
		}
		crc ^= 0xFF;
		return crc;
	}

private:
	/* -------------------------------------------------------------------------------------
	 * -------------------------------------------------------------------------------------
	 * */
	byte_t crc8table[256];

	/* -------------------------------------------------------------------------------------
	 * -------------------------------------------------------------------------------------
	 * */
	dbyte_t crc16table[256];

	/* -------------------------------------------------------------------------------------
	 * Makes codes. Standart polynome: 0x8005
	 * -------------------------------------------------------------------------------------
	 * */
	inline void CRC16_MakeTable()
	{
		dbyte_t i;
		dbyte_t r;
		byte_t j;

		for (i = 0; i < 256; i++) {
			r = i << 8;
			for (j = 0; j < 8; j++) {
				if (r & (1 << 15))
					r = (r << 1) ^ 0x8005;
				else
					r = r << 1;
			}
			this->crc16table[i] = r;
		}
	}

	/* -------------------------------------------------------------------------------------
	 * Makes codes. Standart polynome: 0x31
	 * -------------------------------------------------------------------------------------
	 * */
	inline void CRC8_MakeTable()
	{
		dbyte_t i;
		byte_t r;
		byte_t j;

		for (i = 0; i < 256; i++) {
			r = static_cast<byte_t>(i);
			for (j = 0; j < 8; j++) {
				if ((r & 0x80))
					r = (r << 1) ^ 0x31;
				else
					r = r << 1;
			}
			this->crc8table[i] = r;
		}
	}
};

/* -----------------------------------------------------------------------------------------
 * Object for using
 * -----------------------------------------------------------------------------------------
 * */
const CheckSum CHECK_SUM_CRC;

#endif
